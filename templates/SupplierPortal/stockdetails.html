{% extends 'SupplierPortal/supplier_base.html' %}
{% block body_block %}
{% load static %}

<div class="content-wrapper">
    <div class="col-12 grid-margin stretch-card">
        <div class="card">
            
            
            <div class="card-body">
                <h3 class="card-title">Stocks</h3>
                <div class="row p-3">
                    <div class="col-mg-4 mr-2">
                        <label >Branch</label>
                        <input type="text" class="form-control" value="{{supplier.supplier}}" readonly>
                    </div>
                    <div class="col-mg-4">
                        <label >Branch Store</label>
                        <input type="text" class="form-control" value="{{supplier.name}}({{supplier.storetype}})" readonly>
                    </div>
    
                </div>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0"> Inventory</h3>
                    <a href="{% url 'upload_supplierinventory_csv' %}" class="btn btn-primary">
                        + Import Inventory Stocks
                    </a>
                </div>
             
                <div class="table-responsive">
                    <table id="tableID" class="display table table-hover">
                        <thead class="bg-col">
                            <tr>
                                <th>No.</th>
                     
                                <th>Brand</th>
                                <th>Product</th>
                                 <th>Bar code</th>
                                <th>Unit</th>
                                <th>Quantity</th>
                                <th>Expiry Date</th>
                                <th>Batch</th>
                                <th>Packsize</th>
                                <th>Price</th>
                                <th>Tax</th>
                                <th>discount</th>
                                <th>discount_type</th>
                                <th>manufacture_date</th>
                            
                              
                            </tr>
                        </thead>
                        <tbody>
                            {% for data in records %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                           
                                <td>{{data.item_unit.brand}}</td>
                                <td>
                                        {% if data.item_unit.barcode_image %}
                                      <img src="{{ data.item_unit.barcode_image.url }}" alt="Barcode" class="square-barcode" onclick="openBarcodePopup('{{ data.item_unit.barcode_image.url }}')">


                                        {% else %}
                                            No Barcode
                                        {% endif %}
                                    </td> 
                                <td>{{data.item_unit.item}}</td>
                                <td>{{data.item_unit.conversion_factor_to_base}}/{{data.item_unit.unit.symbol}}</td>
                                <td>{{data.stock_balance}}</td>
                                <td>{{data.expiry_date}}</td>
                                <td>{{data.batch_no}}</td>
                                <td>{{data.packsize}}</td>
                                <td>{% if data.receivetype == 'Piece' %}{{data.item_unit.price}}{% else %}{{data.packsize.pack_price}} {% endif %}</td>
                          
                                <td>{{data.tax}}</td>
                             
                                    <td>{{data.discount}}</td>
                                    <td>{{data.discount_type}}</td>
                                    <td>{{data.manufacture_date}}</td>
                               
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <br><br><br>

            </div>
         
        </div>
    </div>
</div>
<!-- Barcode Modal -->
<div id="barcodeModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.7);">
  <span onclick="closeBarcodePopup()" style="position:absolute; top:20px; right:40px; font-size:30px; color:white; cursor:pointer;">&times;</span>
  <div style="margin:auto; padding-top:10%; text-align:center;">
    <img id="popupBarcode" src="" style="max-width:80%; max-height:80%; border:5px solid white; background:white; padding:10px;">
  </div>
</div>
<script>
  function openBarcodePopup(src) {
    document.getElementById("popupBarcode").src = src;
    document.getElementById("barcodeModal").style.display = "block";
  }

  function closeBarcodePopup() {
    document.getElementById("barcodeModal").style.display = "none";
  }

  // Optional: close modal on background click
  window.onclick = function(event) {
    var modal = document.getElementById("barcodeModal");
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>


{% endblock %}
